<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd        http://camel.apache.org/schema/spring       http://camel.apache.org/schema/spring/camel-spring.xsd">
    <bean class="org.apache.commons.dbcp.BasicDataSource"
        destroy-method="close" id="dataSourceHana">
        <property name="driverClassName" value="org.postgresql.Driver"/>
        <property name="url" value="jdbc:postgresql://{{postgre.host}}:{{postgre.port}}/testdb?useTimezone=true&amp;serverTimezone=UTC"/>
        <property name="username" value="{{postgre.user}}"/>
        <property name="password" value="{{postgre.password}}"/>
    </bean>
    <camelContext id="camel" xmlns="http://camel.apache.org/schema/spring">
        <dataFormats>
            <json allowJmsType="true" allowUnmarshallType="true"
                contentTypeHeader="false"
                enableJaxbAnnotationModule="false"
                id="bsRegLog_dataformat" library="Jackson"
                prettyPrint="false"
                unmarshalTypeName="org.awda.middleware.pojo.RegLog"
                useDefaultObjectMapper="true" useList="false"/>
        </dataFormats>
        <restConfiguration bindingMode="off" component="jetty"
            contextPath="/" host="0.0.0.0" port="9090"/>
        <rest id="rest-82871616-cbc5-4dd8-8554-1d8c03e8246f">
            <post id="69ad8ef4-de07-4844-8a02-ac862035380f" uri="/service/reg">
                <to uri="direct:bs_reg_log"/>
            </post>
        </rest>
        <route id="_bs_reg_log">
            <from id="_from1" uri="direct:bs_reg_log"/>
            <wireTap id="_wireTap1" uri="direct:gen_log">
                <body>
                    <simple>${body}</simple>
                </body>
            </wireTap>
            <process id="_init_strategy_bs_reg_log" ref="killRoute"/>
            <doTry id="_doTry1">
            <bean id="_bean4" ref="payloadValidator"/>
            <to id="_to1" uri="direct:gen_sign"/>
            <unmarshal id="_unmarshal1">
                <custom ref="bsRegLog_dataformat"/>
            </unmarshal>
            <bean id="_bean2" ref="reqBsRegLog"/>
            <wireTap id="_wireTap2" uri="direct:gen_log">
                <body>
                    <simple>${body}</simple>
                </body>
            </wireTap>
            <to id="_to2" uri="https4://{{bs.env}}{{service.reglog.url}}?bridgeEndpoint=true&amp;connectionClose=true&amp;throwExceptionOnFailure=false"/>
            <marshal id="_marshal1">
                <json library="Jackson"/>
            </marshal>
            <wireTap id="_wireTap3" uri="direct:gen_log"/>
             <doCatch id="_doCatch1">
                    <exception>java.io.IOException</exception>
                    <exception>java.lang.StringIndexOutOfBoundsException</exception>
                    <exception>org.apache.camel.component.file.GenericFileOperationFailedException</exception>
                    <exception>java.lang.NullPointerException</exception>
                    <exception>java.lang.IllegalArgumentException</exception>
                    <exception>org.jboss.netty.handler.timeout.ReadTimeoutException</exception>
                    <exception>org.apache.camel.ExpressionEvaluationException</exception>
                    <exception>org.apache.camel.CamelExchangeException</exception>
                    <exception>org.apache.camel.language.bean.RuntimeBeanExpressionException</exception>
                    <exception>org.apache.camel.InvalidPayloadException</exception>
                    <exception>org.apache.camel.NoTypeConversionAvailableException</exception>
                    <log id="co_log9" message="Error Message : ${exception.message}, Body : ${body}"/>
                    <setHeader headerName="Exchange.HTTP_RESPONSE_CODE" id="co_setHeader13">
                        <constant>500</constant>
                    </setHeader>
                    <convertBodyTo id="_convertBodyTo3" type="java.lang.String"/>
                    <setBody id="co_setBody6">
                        <simple>Internal Server Error</simple>
                    </setBody>
                </doCatch>
            </doTry>
        </route>
        <route id="_gen_sign">
            <from id="_from31" uri="direct:gen_sign"/>
            <process id="_init_strategy_gen_sign" ref="killRoute"/>
            <throttle id="_throttle1" timePeriodMillis="100">
                <constant>1</constant>
                <bean id="_bean1" method="process('input')" ref="genSign"/>
            </throttle>
        </route>
        <route id="_gen_log">
            <from id="_from2" uri="direct:gen_log"/>
            <process id="_init_strategy_gen_log" ref="killRoute"/>
            <to id="_to3" uri="sql:insert into transaction_log values (:#id,:#payload)"/>
        </route>
       
    </camelContext>
    <bean class="org.awda.middleware.util.KillRoute" id="killRoute" scope="singleton"/>
    <bean class="org.awda.middleware.util.GenerateSignature"
        id="genSign" scope="singleton"/>
    <bean class="org.awda.middleware.bs.GenReqRegLog" id="reqBsRegLog" scope="singleton"/>
    <bean class="org.awda.middleware.util.MessageValidator"
        id="payloadValidator" scope="singleton"/>
</beans>
