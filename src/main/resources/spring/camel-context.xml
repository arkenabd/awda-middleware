<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd        http://camel.apache.org/schema/spring       http://camel.apache.org/schema/spring/camel-spring.xsd">
    <bean class="org.awda.middleware.util.KillRoute" id="killRoute" scope="singleton"/>
    <bean class="org.awda.middleware.util.GenerateSignature"
        id="genSign" scope="singleton"/>
    <bean class="org.awda.middleware.util.MessageValidator"
        id="payloadValidator" scope="singleton"/>
    <bean class="org.apache.commons.dbcp.BasicDataSource"
        destroy-method="close" id="dataSourceHana">
        <property name="driverClassName" value="org.postgresql.Driver"/>
        <property name="url" value="jdbc:postgresql://{{postgre.host}}:{{postgre.port}}/testdb?useTimezone=true&amp;serverTimezone=UTC"/>
        <property name="username" value="{{postgre.user}}"/>
        <property name="password" value="{{postgre.password}}"/>
    </bean>
    <!-- import routeBS.xml-->
    <import resource="routeBS7.xml"/>
    <import resource="routeBS8.xml"/>
    <camelContext id="camel" xmlns="http://camel.apache.org/schema/spring">
        <!-- reference routeBS depend on routeContext id="routeBS7" on routeBS.xml-->
        <routeContextRef ref="routeBS7"/>
        <routeContextRef ref="routeBS8"/>
        <dataFormats>
            <json allowJmsType="true" allowUnmarshallType="true"
                contentTypeHeader="false"
                enableJaxbAnnotationModule="false"
                id="bsRegLog_dataformat" library="Jackson"
                prettyPrint="false"
                unmarshalTypeName="org.awda.middleware.pojo.RegLog"
                useDefaultObjectMapper="true" useList="false"/>
        </dataFormats>
        <restConfiguration bindingMode="off" component="jetty"
            contextPath="/" host="0.0.0.0" port="9090"/>
        <rest id="rest-82871616-cbc5-4dd8-8554-1d8c03e8246f">
            <post id="69ad8ef4-de07-4844-8a02-ac862035380f" uri="/welab-sun/api/{appId}/regOrLogin">
                <to uri="direct:bs_reg_log"/>
            </post>
        </rest>
        <route id="_gen_sign">
            <from id="_from31" uri="direct:gen_sign"/>
            <process id="_init_strategy_gen_sign" ref="killRoute"/>
            <throttle id="_throttle1" timePeriodMillis="100">
                <constant>1</constant>
                <bean id="_bean1" method="process('input')" ref="genSign"/>
            </throttle>
        </route>
        <route id="_gen_log">
            <from id="_from2" uri="direct:gen_log"/>
            <process id="_init_strategy_gen_log" ref="killRoute"/>
            <to id="_to3" uri="mock:sql:insert into transaction_log values (:#id,:#payload)"/>
        </route>
    </camelContext>
</beans>
